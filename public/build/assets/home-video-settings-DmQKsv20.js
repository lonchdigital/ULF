document.addEventListener("DOMContentLoaded",function(){const r=document.getElementById("section-top"),d=r.querySelector("video.d-none.d-sm-block"),u=r.querySelector("video.d-sm-none"),n=window.innerWidth>=767?d:u;n&&(n.autoplay=!0,n.muted=!0,n.loop=!0,new IntersectionObserver(c=>{c.forEach(s=>{s.isIntersecting?n.play().catch(i=>{console.warn("Автовоспроизведение заблокировано браузером:",i)}):n.pause()})},{threshold:.5}).observe(r))});document.addEventListener("DOMContentLoaded",function(){const r=document.querySelectorAll(".specific-player");r.forEach(e=>{e.muted=!0,e.playsinline=!0}),(()=>{const e=document.createElement("button");e.style.display="none",document.body.appendChild(e),e.click(),document.body.removeChild(e)})();const u=new IntersectionObserver(e=>{e.forEach(c=>{const s=c.target,i=s.closest(".video-wrap");if(!i)return;const a=i.querySelector(".btn-video-play-pause");s.closest("#customer-stories-mobile")||(c.isIntersecting?(s.play().catch(o=>{console.warn("Автовоспроизведение заблокировано браузером:",o)}),a&&a.classList.add("active"),i.classList.add("playing")):(s.pause(),a&&a.classList.remove("active"),i.classList.remove("playing")))})},{threshold:.5});r.forEach(e=>{!e.closest("#customer-stories")&&!e.closest("#customer-stories-mobile")&&u.observe(e)});const n=document.getElementById("customer-stories");if(n){window.lastClickedVideo=null;let e=null;document.querySelectorAll("#customer-stories-pc .video-wrap").forEach(o=>{o.addEventListener("click",function(l){const t=this.querySelector("video");if(!t)return;const p=t.getBoundingClientRect(),m=l.clientX-p.left,f=p.width*.2,y=p.width*.8;m>=f&&m<=y&&(t.paused?(t.play(),window.lastClickedVideo=t,e=Array.from(c).indexOf(t)):(t.pause(),window.lastClickedVideo=null))})});const c=Array.from(n.querySelectorAll(".specific-player")).filter(o=>!o.closest("#customer-stories-mobile"));let s=0;const i=()=>{if(e!==null&&(s=e,e=null),s>=c.length)return;let o=window.lastClickedVideo||c[s];window.lastClickedVideo=null,c.forEach(t=>{t!==o&&(t.pause(),t.closest(".video-wrap").classList.remove("playing"))});const l=o.closest(".video-wrap");l.classList.add("playing"),o.play().catch(t=>{console.warn("Автовоспроизведение заблокировано:",t)}),o.onended=()=>{l.classList.remove("playing"),s++,i()}};new IntersectionObserver(o=>{o.forEach(l=>{l.isIntersecting?i():c.forEach(t=>{t.pause(),t.closest(".video-wrap").classList.remove("playing")})})},{threshold:.5}).observe(n)}});document.addEventListener("touchstart",()=>{document.querySelectorAll(".specific-player").forEach(r=>{r.play().catch(d=>{console.warn("Автовоспроизведение на iOS не удалось, пробуем еще раз.",d)})})},{once:!0});
